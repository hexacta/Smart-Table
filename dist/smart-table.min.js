!function(e,t){"use strict";e.module("smart-table",[]).run(["$templateCache",function(e){e.put("template/smart-table/pagination.html",'<nav ng-if="pages.length >= 2"><ul class="pagination"><li ng-repeat="page in pages" ng-class="{active: page==currentPage}"><a ng-click="selectPage(page)">{{page}}</a></li></ul></nav>')}]),e.module("smart-table").constant("stConfig",{pagination:{template:"template/smart-table/pagination.html",itemsByPage:10,displayedPages:5},search:{delay:400},select:{mode:"single",selectedClass:"st-selected"},sort:{ascentClass:"st-sort-ascent",descentClass:"st-sort-descent",skipNatural:!1},pipe:{delay:100},searchType:{server:!0}}),e.module("smart-table").controller("stTableController",["$scope","$parse","$filter","$attrs","stConfig",function(a,s,n,r,i){function c(e){return e?[].concat(e):[]}function l(){b=c(o(a)),v===!0&&P.pipe()}var o,u,p,g=r.stTable,f=s(g),d=f.assign,h=n("orderBy"),m=n("filter"),b=c(f(a)),S={sort:{},search:{},pagination:{start:0}},v=!0,P=this;r.stSafeSrc&&(o=s(r.stSafeSrc),a.$watch(function(){var e=o(a);return e?e.length:0},function(e){e!==b.length&&l()}),a.$watch(function(){return o(a)},function(e,t){e!==t&&l()})),this.sortBy=function(t,a){return S.sort.predicate=t,S.sort.reverse=a===!0,e.isFunction(t)?S.sort.functionName=t.name:delete S.sort.functionName,S.pagination.start=0,this.pipe()},this.search=function(t,a){var s=S.search.predicateObject||{},n=a?a:"$";return t=e.isString(t)?t.trim():t,s[n]=t,t||delete s[n],S.search.predicateObject=s,S.pagination.start=0,this.pipe()},this.pipe=function(){i.searchType.server?this.serverSearch():this.localSearch()},this.serverSearch=function(){var e=this,s=S.pagination,n={params:{orderBy:S.sort.predicate,reverse:S.sort.reverse,filter:S.search.predicateObject?S.search.predicateObject.$:t,offset:s.start,pageSize:s.number}};a[r.stSearchFn](n).success(function(t){u=t[0].collection;var n=e.paginate(s,t[0].length);d(a,n||u)})},this.localSearch=function(){var e=this,t=S.pagination;u=S.search.predicateObject?m(b,S.search.predicateObject):b,S.sort.predicate&&(u=h(u,S.sort.predicate,S.sort.reverse));var s=e.paginate(t,u.length);d(a,s||u)},this.paginate=function(e,a){return e.number!==t?(e.numberOfPages=a>0?Math.ceil(a/e.number):1,e.start=e.start>=a?(e.numberOfPages-1)*e.number:e.start,u.slice(e.start,e.start+parseInt(e.number))):[]},this.select=function(e,s){var n=c(f(a)),r=n.indexOf(e);-1!==r&&("single"===s?(e.isSelected=e.isSelected!==!0,p&&(p.isSelected=!1),p=e.isSelected===!0?e:t):n[r].isSelected=!n[r].isSelected)},this.slice=function(e,t){return S.pagination.start=e,S.pagination.number=t,this.pipe()},this.tableState=function(){return S},this.getFilteredCollection=function(){return u||b},this.setFilterFunction=function(e){m=n(e)},this.setSortFunction=function(e){h=n(e)},this.preventPipeOnWatch=function(){v=!1}}]).directive("stTable",function(){return{restrict:"A",controller:"stTableController",link:function(e,t,a,s){a.stSetFilter&&s.setFilterFunction(a.stSetFilter),a.stSetSort&&s.setSortFunction(a.stSetSort)}}}),e.module("smart-table").directive("stSearch",["stConfig","$timeout",function(e,t){return{require:"^stTable",link:function(a,s,n,r){var i=r,c=null,l=n.stDelay||e.search.delay;n.$observe("stSearch",function(e,t){var a=s[0].value;e!==t&&a&&(r.tableState().search={},i.search(a,e))}),a.$watch(function(){return r.tableState().search},function(e){var t=n.stSearch||"$";e.predicateObject&&e.predicateObject[t]!==s[0].value&&(s[0].value=e.predicateObject[t]||"")},!0),s.bind("input",function(e){e=e.originalEvent||e,null!==c&&t.cancel(c),c=t(function(){i.search(e.target.value,n.stSearch||""),c=null},l)})}}}]),e.module("smart-table").directive("stSelectRow",["stConfig",function(e){return{restrict:"A",require:"^stTable",scope:{row:"=stSelectRow"},link:function(t,a,s,n){var r=s.stSelectMode||e.select.mode;a.bind("click",function(){t.$apply(function(){n.select(t.row,r)})}),t.$watch("row.isSelected",function(t){t===!0?a.addClass(e.select.selectedClass):a.removeClass(e.select.selectedClass)})}}}]),e.module("smart-table").directive("stSort",["stConfig","$parse",function(a,s){return{restrict:"A",require:"^stTable",link:function(n,r,i,c){function l(){g++,u=e.isFunction(p(n))?p(n):i.stSort,g%3===0&&!!m!=!0?(g=0,c.tableState().sort={},c.tableState().pagination.start=0,c.pipe()):c.sortBy(u,g%2===0)}var o,u=i.stSort,p=s(u),g=0,f=i.stClassAscent||a.sort.ascentClass,d=i.stClassDescent||a.sort.descentClass,h=[f,d],m=i.stSkipNatural!==t?i.stSkipNatural:a.skipNatural;i.stSortDefault&&(o=n.$eval(i.stSortDefault)!==t?n.$eval(i.stSortDefault):i.stSortDefault),r.bind("click",function(){u&&n.$apply(l)}),o&&(g="reverse"===o?1:0,l()),n.$watch(function(){return c.tableState().sort},function(e){e.predicate!==u?(g=0,r.removeClass(f).removeClass(d)):(g=e.reverse===!0?2:1,r.removeClass(h[g%2]).addClass(h[g-1]))},!0)}}}]),e.module("smart-table").directive("stPagination",["stConfig",function(e){return{restrict:"EA",require:"^stTable",scope:{stItemsByPage:"=?",stDisplayedPages:"=?",stPageChange:"&"},templateUrl:function(t,a){return a.stTemplate?a.stTemplate:e.pagination.template},link:function(t,a,s,n){function r(){var e,a,s=n.tableState().pagination,r=1,i=t.currentPage;for(t.currentPage=Math.floor(s.start/s.number)+1,r=Math.max(r,t.currentPage-Math.abs(Math.floor(t.stDisplayedPages/2))),e=r+t.stDisplayedPages,e>s.numberOfPages&&(e=s.numberOfPages+1,r=Math.max(1,e-t.stDisplayedPages)),t.pages=[],t.numPages=s.numberOfPages,a=r;e>a;a++)t.pages.push(a);i!==t.currentPage&&t.stPageChange({newPage:t.currentPage})}t.stItemsByPage=t.stItemsByPage?+t.stItemsByPage:e.pagination.itemsByPage,t.stDisplayedPages=t.stDisplayedPages?+t.stDisplayedPages:e.pagination.displayedPages,t.currentPage=1,t.pages=[],t.$watch(function(){return n.tableState().pagination},r,!0),t.$watch("stItemsByPage",function(e,a){e!==a&&t.selectPage(1)}),t.$watch("stDisplayedPages",r),t.selectPage=function(e){e>0&&e<=t.numPages&&n.slice((e-1)*t.stItemsByPage,t.stItemsByPage)},n.tableState().pagination.number||n.slice(0,t.stItemsByPage)}}}]),e.module("smart-table").directive("stPipe",["stConfig","$timeout",function(t,a){return{require:"stTable",scope:{stPipe:"="},link:{pre:function(s,n,r,i){var c=null;e.isFunction(s.stPipe)&&(i.preventPipeOnWatch(),i.pipe=function(){return null!==c&&a.cancel(c),c=a(function(){s.stPipe(i.tableState(),i)},t.pipe.delay)})},post:function(e,t,a,s){s.pipe()}}}}])}(angular);